<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Exam Result - Online Exam System</title>
    <script>
        // Disable back button
        window.history.pushState(null, "", window.location.href);        
        window.onpopstate = function () {
            window.history.pushState(null, "", window.location.href);
        };
        
        // Prevent page refresh
        window.onbeforeunload = null;
    </script>
</head>
<body>
    <div>
        <header>
            <h1>Online Exam System - Exam Result</h1>
            <div>
                Student: ${studentName}
            </div>
        </header>
        
        <c:if test="${not empty message}">
            <div style="color: orange; margin: 10px 0;">
                ${message}
            </div>
        </c:if>
        
        <main>
            <h2>Exam Results</h2>
            
            <div style="border: 2px solid #4CAF50; padding: 20px; margin: 20px 0; background-color: #f9f9f9;">
                <h3>Exam Details</h3>
                <p><strong>Exam Title:</strong> ${exam.examTitle}</p>
                <p><strong>Subject:</strong> ${exam.subject}</p>
                <p><strong>Total Questions:</strong> ${totalQuestions}</p>
                <p><strong>Total Marks:</strong> ${exam.totalmarks}</p>
                
                <hr>
                
                <h3>Your Performance</h3>
                <p><strong>Correct Answers:</strong> ${correctAnswers} out of ${totalQuestions}</p>
                <p><strong>Marks Obtained:</strong> ${obtainedMarks} out of ${exam.totalmarks}</p>
                
                <c:set var="percentage" value="${(obtainedMarks * 100) / exam.totalmarks}" />
                <p><strong>Percentage:</strong> <fmt:formatNumber value="${percentage}" maxFractionDigits="2" />%</p>
                
                <c:choose>
                    <c:when test="${percentage >= 80}">
                        <p style="color: green; font-weight: bold;">Grade: Excellent</p>
                    </c:when>
                    <c:when test="${percentage >= 70}">
                        <p style="color: blue; font-weight: bold;">Grade: Good</p>
                    </c:when>
                    <c:when test="${percentage >= 60}">
                        <p style="color: orange; font-weight: bold;">Grade: Satisfactory</p>
                    </c:when>
                    <c:when test="${percentage >= 50}">
                        <p style="color: red; font-weight: bold;">Grade: Pass</p>
                    </c:when>
                    <c:otherwise>
                        <p style="color: red; font-weight: bold;">Grade: Fail</p>
                    </c:otherwise>
                </c:choose>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <a href="DashboardController" 
                   style="background-color: #4CAF50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                    Back to Dashboard
                </a>
                
                <button onclick="window.print()" 
                        style="background-color: #008CBA; color: white; padding: 10px 20px; margin-left: 10px; border: none; border-radius: 5px; cursor: pointer;">
                    Print Result
                </button>
            </div>
            
            <div style="margin-top: 30px; font-size: 12px; color: #666;">
                <p><strong>Note:</strong> This result has been automatically generated by the Online Exam System.</p>
                <p>Exam completed on: <fmt:formatDate value="<%=new java.util.Date()%>" pattern="dd/MM/yyyy HH:mm:ss" /></p>
            </div>
        </main>
    </div>
</body>
</html>